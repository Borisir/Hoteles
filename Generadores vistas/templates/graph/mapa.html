{% extends 'template.html' %}

{% block content %}
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mapa de Grafos</title>
    <script type="text/javascript" src="https://unpkg.com/vis-network/standalone/umd/vis-network.min.js"></script>
    <style>
        /* Estilo para el contenedor del mapa */
        #mynetwork {
            width: 90%; /* Ancho del contenedor del grafo, ocupando el 90% del ancho de la página */
            height: 600px; /* Altura del contenedor */
            border: 3px solid lightgray; /* Borde del contenedor en color gris claro */
        }

        /* Estilo para el título */
        h2 {
            text-align: center; /* Centra el texto del título */
            margin-top: 30px; /* Espaciado superior de 30px */
        }
    </style>
</head>
<body>
    <h2>Visualización del Grafo</h2>
    <div id="mynetwork"></div>

    <script>
        // Asegúrate de que los datos estén correctamente formateados en JSON
        const graphData = JSON.parse('{{ graph_data | tojson | safe }}'); // Convierte los datos del grafo en formato JSON

        if (graphData && graphData.nodes && graphData.edges) {
            // Crear un conjunto de nodos con las propiedades adecuadas
            const nodes = new vis.DataSet(graphData.nodes.map(node => ({
                id: node.id,
                label: node.name, // Utiliza el campo 'name' del nodo como la etiqueta
                size: 80, // Tamaño fijo de los nodos
                shape: 'ellipse', // Forma del nodo (elíptica)
            })));

            // Crear un conjunto de aristas con las propiedades adecuadas
            const edges = new vis.DataSet(graphData.edges.map(edge => ({
                from: edge.from,
                to: edge.to,
                label: edge.weight.toString(), // Etiqueta de la arista, usando el peso como texto
                font: { size: 14, align: 'top' }, // Tamaño de la fuente de la etiqueta de la arista
                width: 2, // Grosor de las aristas
            })));

            // Opciones para la visualización del grafo
            const container = document.getElementById('mynetwork'); // Obtiene el contenedor donde se dibujará el grafo
            const data = { nodes, edges }; // Datos para el grafo (nodos y aristas)

            const options = { 
                nodes: {
                    shape: "ellipse", // Forma de los nodos (elíptica)
                    size: 30, // Tamaño predeterminado de los nodos
                },
                physics: {
                    enabled: true, // Habilita el modelo físico para la simulación del grafo
                    barnesHut: {
                        gravitationalConstant: -5000, // Fuerza gravitacional negativa para separar los nodos
                        centralGravity: 0.1, // Gravedad central que afecta la posición de los nodos
                        springLength: 240, // Longitud de los resortes entre los nodos (a mayor valor, mayor separación)
                        springConstant: 0.024, // Constante del resorte para la fuerza de repulsión entre nodos
                    }
                }
            };

            // Crea la red de nodos y aristas en el contenedor especificado con las opciones definidas
            new vis.Network(container, data, options);
        } else {
            console.error("Error: No se encontraron datos de grafo");
        }
    </script>
</body>
</html>
{% endblock %}
